---
title: 'Coursera Data Science: Reproducible Reaserch: Assignment 2'
author: "Iraklis Konstantopoulos"
date: "26 April 2015"
output: html_document
---

This document presents an analysis of storm data from the National Oceanic and Atmospheric Administration (NOAA) storm database. The desired outcome is to determine the types of events that cause most measurable harm and appreciable financial damage across the United States. It makes use of public NOAA data. 

## Data Preparation

The original NOAA dataset was obtained from: 

    https://d396qusza40orc.cloudfront.net/repdata%2Fdata%2FStormData.csv.bz2

and the file was unzipped using the native Mac OS archive utility. The unzipped CSV file should be linked to the working directory for the code segments in this document to execute afresh. 

A summarry of the CSV file is as follows: 

```{r}{cache=TRUE}
library(dplyr)
df <- read.csv("StormData.csv")
str(df)
```

A full list of events is held in the `EVTYPE` factor. There are too many to list in a sensible format. Specifically: 

```{r}
eventType <- unique(df$EVTYPE)
paste("Events are divided into", length(eventType), "categories.")
```

This listing was saved to a variable as it will come in handy later. 

There are two tracers of damage, property damage (`PROPDMG`) and crop damage (`CROPDMG`). In order to assess damage the two tracers are combined into a new column, `TotalDamage`: 

```{r}
df <- mutate(df, TotalDamage = PROPDMG + CROPDMG)
str(df$TotalDamage)
```

## Data Analysis
Having prepared our dataset by adding a column for economic damage, we are ready to assess the human and material impact of the storms in the database. 

### Impact on Health
First we treat the human element. There are two relevant tracers, injuries (`INJURIES`) and fatalities (`FATALITIES`) but we did not combine these are they are appreciably distinct events. 

The types of events that caused the most injuries and the highest death toll are the following: 

```{r}
topInjury <- df$EVTYPE[which.max(df$INJURIES)]
topFatality <- df$EVTYPE[which.max(df$FATALITIES)]

paste("The event that caused the most injuries was a", topInjury, "'")
paste("The event with the higest death toll is classified as", topFatality)
```

The 'tornado' designation is clear, while 'heat' is less so. On p.43 of the [accompanying documentation](https://d396qusza40orc.cloudfront.net/repdata%2Fpeer2_doc%2Fpd01016005curr.pdf) an event of type 'heat' is described as: 

> A period of heat resulting from the
> combination of high temperatures (above
> normal) and relative humidity. 

In other words, a prolonged heat wave is the single worst event archived in the NOAA database. It occurred in Illinois in July of 1961: 

```{r}
df$STATE[topFatality]; df$BGN_DATE[topFatality]
```

### Impact on Property and Crops
The financial impact is codified in the way described in the appendix of the [code book](https://d396qusza40orc.cloudfront.net/repdata%2Fpeer2_doc%2Fpd01016005curr.pdf). In brief, the code book lists a number of events and their quantised moetary worth. For example, a broken windshield incurs an approximate cost in the range of $250-$1000, and hence an entry of 0.25 according to the base value of thousands of US dollars. 

In order to ascertain the most catastrophic type of events in terms of financial impact we will filter the data frame by each type of event and produce a listing of average damage by event type using the newly created `TotalDamage` variable. 

```{r}
meanDamage <- numeric(length(eventType))
counter <- 0
for(ev in eventType){
    counter = counter + 1
    meanDamage[counter] <- mean(df$TotalDamage[which(df$EVTYPE == ev)])
}
```

To aid presentation and data lookup we have saved this listing of mean damage along with the descriptive name of the event in a new data frame, which we then sorted by damage. 

```{r}
damage <- data.frame(cbind(eventType, meanDamage), stringsAsFactors = FALSE)
damage <- arrange(damage, desc(meanDamage))

print("The ten most damaging types of events are")
head(eventType[damage$eventType], n=10)
```


## Results
